const{remote:e,shell:t,ipcRenderer:n,clipboard:o}=require("electron"),d=require("electron-store"),r=e.app.getVersion(),a="https://gitee.com/api/v5/repos/xenkuo/comNG/releases/latest";var l,c,i,s=require("materialize-css");s.AutoInit();const m=new d({projectVersion:r,migrations:{"1.0.3":e=>{e.delete("desert"),e.delete("about"),e.set("window.width",600),e.set("window.height",640),e.set("window.widthBefore",600),e.set("window.heightBefore",640),e.set("window.xBefore",0),e.set("window.yBefore",0),e.set("menu.hidden",!0),e.set("menu.tab","general"),e.set("baudIndex",2),e.set("pathIndex",0),e.set("general.hexmode",!1),e.set("general.timestamp",!1),e.set("general.customized",9600),e.set("general.databitsIndex",0),e.set("general.parityIndex",0),e.set("general.stopbitsIndex",0),e.set("general.flowcontrolIndex",0),e.set("transmit.eof","\r\n"),e.set("advance.sign.switch",!1),e.set("advance.sign.name",""),e.set("advance.breakpoint.switch",!1),e.set("advance.breakpoint.onText","Error"),e.set("advance.breakpoint.afterLines",5),e.set("advance.barColor.head","#fafafa"),e.set("advance.barColor.middle","#fafafa"),e.set("advance.barColor.tail","#26a69a")},"1.0.4":e=>{e.set("general.modemSignal",!1),e.set("general.fontFamily","Consolas, 'SF Mono', Menlo, 'Lucida Console', 'Courier New', monospace"),e.set("general.fontSize",12)}}});function g(e,t){let n=e.split(".");1===n.length?l[n[0]]=t:2===n.length?l[n[0]][n[1]]=t:3===n.length?l[n[0]][n[1]][n[2]]=t:console.error("config key structure error"),m.set(e,t)}n.on("main-cmd",(e,t)=>{switch(console.log(t),t){case"Clear":{let e=B.getModel().getValue();o.writeText(e),B.getModel().setValue("");break}case"Switch":document.getElementById("port-switch").click();break;case"ClearSwitch":{let e=document.getElementById("port-switch");if(e.click(),1==e.checked){let e=B.getModel().getValue();o.writeText(e),B.getModel().setValue("")}}break;case"Open":R();break;case"Save":D();break;default:console.log("Unknown cmds")}}),window.onload=()=>{l=m.store,document.getElementById("menu-area").hidden=l.menu.hidden,c=getComputedStyle(document.documentElement).getPropertyValue("--bar-height").trim().split("px")[0],c=parseInt(c),i=getComputedStyle(document.documentElement).getPropertyValue("--menu-height").trim().split("px")[0],i=parseInt(i);let e=document.getElementById("nav-area"),n=document.getElementById("bar-area"),o=document.getElementById("menu-area");document.getElementById("editor-area").style.height=window.innerHeight-e.offsetHeight-n.offsetHeight-o.offsetHeight+"px",s.Tabs.getInstance(document.getElementById("menu-tabs")).select(l.menu.tab);let d=document.getElementById("baud-select");d.options[0].text=l.general.customized,d.selectedIndex=l.baudIndex,s.FormSelect.init(d),Y(),document.getElementById("hexmode-switch").checked=l.general.hexmode,document.getElementById("timestamp-switch").checked=l.general.timestamp,document.getElementById("modem-signal-switch").checked=l.general.modemSignal,!0===l.general.modemSignal?document.getElementById("modem-signal-bar").hidden=!1:document.getElementById("modem-signal-bar").hidden=!0,document.getElementById("customized").value=l.general.customized;let g=document.getElementById("databits-select");g.selectedIndex=l.general.databitsIndex,s.FormSelect.init(g);let u=document.getElementById("parity-select");u.selectedIndex=l.general.parityIndex,s.FormSelect.init(u);let f=document.getElementById("stopbits-select");f.selectedIndex=l.general.stopbitsIndex,s.FormSelect.init(f);let h=document.getElementById("flowcontrol-select");h.selectedIndex=l.general.flowcontrolIndex,s.FormSelect.init(h),document.getElementById("editor-font-family").value=l.general.fontFamily,document.getElementById("editor-font-size").value=l.general.fontSize,document.getElementById("breakpoint-switch").checked=l.advance.breakpoint.switch,document.getElementById("breakpoint-on-text").value=l.advance.breakpoint.onText,document.getElementById("breakpoint-after-lines").value=l.advance.breakpoint.afterLines,document.getElementById("sign-switch").checked=l.advance.sign.switch,document.getElementById("sign-name").value=l.advance.sign.name,document.getElementById("bar-color-head").value=l.advance.barColor.head,document.getElementById("bar-color-middle").value=l.advance.barColor.middle,document.getElementById("bar-color-tail").value=l.advance.barColor.tail,document.documentElement.style.setProperty("--bar-color-head",l.advance.barColor.head),document.documentElement.style.setProperty("--bar-color-middle",l.advance.barColor.middle),document.documentElement.style.setProperty("--bar-color-tail",l.advance.barColor.tail),document.getElementById("app-version").innerHTML=r,console.log("Current Version: ",r),fetch(a).then(e=>e.json()).then(e=>{let n=e.tag_name.split("v")[1];if(n!==r){const o={type:"info",buttons:["Download Now","Later"],message:"Version: "+n+" released!",detail:e.body};p.showMessageBox(o).then(n=>{0===n.response&&t.openExternal(e.assets[0].browser_download_url)})}})},window.onresize=()=>{g("window.width",window.innerWidth),g("window.height",window.innerHeight);let e=document.getElementById("nav-area"),t=document.getElementById("bar-area"),n=document.getElementById("menu-area");document.getElementById("editor-area").style.height=window.innerHeight-e.offsetHeight-t.offsetHeight-n.offsetHeight+"px"},document.onkeydown=function(e){switch((e=e||window.event).which||e.keyCode){case 13:console.log("hello world 13"),"trans-data"===document.activeElement.id&&document.getElementById("trans-send-btn").click();break;default:console.log("unknown event")}},document.getElementById("nav-area").onmousedown=()=>!1,document.getElementById("nav-area").ondblclick=()=>{window.innerWidth===screen.width||window.innerHeight===screen.height?(window.resizeTo(l.window.widthBefore,l.window.heightBefore),window.moveTo(l.window.xBefore,l.window.yBefore)):(g("window.widthBefore",window.innerWidth),g("window.heightBefore",window.innerHeight),g("window.xBefore",window.screenX),g("window.yBefore",window.screenY),window.resizeTo(screen.width,screen.height),window.moveTo(0,0))},document.getElementById("logo").onclick=()=>{t.openExternal("https://github.com/xenkuo/comNG")},document.getElementById("min-btn").onclick=()=>{e.getCurrentWindow().minimize()},document.getElementById("max-btn").onclick=()=>{g("window.widthBefore",window.innerWidth),g("window.heightBefore",window.innerHeight),g("window.xBefore",window.screenX),g("window.yBefore",window.screenY),window.resizeTo(screen.width,screen.height),window.moveTo(0,0)},document.getElementById("close-btn").onclick=()=>{window.close()},document.getElementById("menu-btn").onclick=()=>{let e=document.getElementById("menu-area"),t=document.getElementById("editor-area");!0===e.hidden?(t.style.height=t.offsetHeight-i+"px",e.hidden=!1,g("menu.hidden",!1)):(t.style.height=t.offsetHeight+i+"px",e.hidden=!0,g("menu.hidden",!0))},document.body.onclick=e=>{if(!1===e.isTrusted)return;if("menu-btn"===e.target.parentNode.id)return;if(1===document.getElementById("menu-tabs").M_Tabs.index)return;let t=e.clientY,n=document.body.offsetHeight;if(t>n-c||t<n-c-i){let e=document.getElementById("menu-area"),t=document.getElementById("editor-area");!1===e.hidden&&(t.style.height=t.offsetHeight+i+"px",e.hidden=!0,g("menu.hidden",!0))}},document.getElementById("menu-tabs").onclick=()=>{g("menu.tab",s.Tabs.getInstance(document.getElementById("menu-tabs")).$content[0].id)},document.getElementById("hexmode-switch").onclick=e=>{g("general.hexmode",e.target.checked)},document.getElementById("timestamp-switch").onclick=e=>{g("general.timestamp",e.target.checked)},document.getElementById("modem-signal-switch").onclick=e=>{let t=e.target.checked;g("general.modemSignal",t),document.getElementById("modem-signal-bar").hidden=!0!==t},document.getElementById("customized").onblur=e=>{let t=parseInt(e.target.value);!0===isNaN(t)&&(t=9600),g("general.customized",t);let n=document.getElementById("baud-select");n.options[0].text=t,s.FormSelect.init(n)},document.getElementById("databits-select").onchange=e=>{g("general.databitsIndex",e.target.selectedIndex)},document.getElementById("parity-select").onchange=e=>{g("general.parityIndex",e.target.selectedIndex)},document.getElementById("stopbits-select").onchange=e=>{g("general.stopbitsIndex",e.target.selectedIndex)},document.getElementById("flowcontrol-select").onchange=e=>{g("general.flowcontrolIndex",e.target.selectedIndex)},document.getElementById("sign-switch").onclick=e=>{g("advance.sign.switch",e.target.checked)},document.getElementById("sign-name").onblur=e=>{g("advance.sign.name",e.target.value)};let u=void 0;document.getElementById("trans-eof-select").onchange=e=>{let t="\r\n";switch(e.target.selectedIndex){case 1:t="\r";break;case 2:t="\n"}g("transmit.eof",t)},document.getElementById("trans-send-btn").onclick=()=>{const e=document.getElementById("trans-log-area");let t=document.getElementById("trans-data").value;if(t.trim(),t+=l.transmit.eof,!1!==Q(t)&&(e.value+="\n"+document.getElementById("trans-data").value,s.updateTextFields(e),s.textareaAutoResize(e),e.scrollTop=e.scrollHeight,!0===document.getElementById("trans-repeat-switch").checked)){void 0!==u&&clearInterval(u);let e=document.getElementById("trans-repeat-interval").value;e=parseInt(e),!0===isNaN(e)&&(e=1e3),u=setInterval(()=>{Q(t)},e)}},document.getElementById("trans-repeat-switch").onchange=e=>{!1===e.target.checked&&void 0!==u&&clearInterval(u)},document.getElementById("trans-log-btn").onclick=()=>{let e=document.getElementById("trans-log-area");e.value="",s.updateTextFields(e),s.textareaAutoResize(e)},document.getElementById("bar-color-head").oninput=e=>{let t=e.target.value;document.documentElement.style.setProperty("--bar-color-head",t),g("advance.barColor.head",t)},document.getElementById("bar-color-middle").oninput=e=>{let t=e.target.value;document.documentElement.style.setProperty("--bar-color-middle",t),g("advance.barColor.middle",t)},document.getElementById("bar-color-tail").oninput=e=>{let t=e.target.value;document.documentElement.style.setProperty("--bar-color-tail",t),g("advance.barColor.tail",t)},document.getElementById("issue").onclick=e=>{console.log("licence click",e),e.preventDefault(),t.openExternal(e.target.href)},document.getElementById("introduction").onclick=e=>{console.log("licence click",e),e.preventDefault(),t.openExternal(e.target.href)},document.getElementById("comnglang").onclick=e=>{console.log("licence click",e),e.preventDefault(),t.openExternal(e.target.href)},document.getElementById("baud-select").onchange=e=>{g("baudIndex",e.target.selectedIndex)},document.getElementById("path-select").onchange=e=>{g("pathIndex",e.target.selectedIndex)},document.getElementById("refresh-btn").onclick=Y;const f=require("fs"),h=require("path"),y=require("../node_modules/monaco-editor/min/vs/loader.js"),{dialog:p}=require("electron").remote,w=y.require,I=8,b=7,E=[{style:"hl-red",color:"#ff8a80"},{style:"hl-orange",color:"#ffd180"},{style:"hl-yellow",color:"#ffff8d"},{style:"hl-green",color:"#b9f6ca"},{style:"hl-blue",color:"8dd8ff"},{style:"hl-indigo",color:"8c9eff"},{style:"hl-purple",color:"ea80fc"}];var B,v=0,k=0,x=!1,C=0,T=[],S=!1,F=0;function N(e){var t=h.resolve(e).replace(/\\/g,"/");return t.length>0&&"/"!==t.charAt(0)&&(t="/"+t),encodeURI("file://"+t)}function M(){return E[F++%7]}function L(e,t){let n=e.findMatches(t,!1,!1,!0,"`~!@#$%^&*()-=+[{]}\\|;:'\",.<>/?",!1),o=M();console.log(o.style,o.color);for(let t of n){let n=t.range;e.deltaDecorations([],[{range:n,options:{className:o.style,overviewRuler:{color:o.color,position:4}}}])}}function A(e,t){let n=e.findMatches(t,!1,!1,!0,"`~!@#$%^&*()-=+[{]}\\|;:'\",.<>/?",!1);for(let t of n){let n=e.getDecorationsInRange(t.range);for(let t of n)e.deltaDecorations([t.id],[])}}function z(){console.log("highligh toggle");let e=1,t=B.getModel(),n=B.getSelection(),o=t.getValueInRange(n);if(""===o){let d=t.getWordAtPosition(B.getPosition());o=d.word,n.startColumn=d.startColumn,n.endColumn=d.endColumn,e=2}if(""!==o)return t.getDecorationsInRange(n).length===e?L(t,o):A(t,o),null}function R(){p.showOpenDialog({properties:["openFile"],filters:[{name:"comNG log",extensions:["cnl","txt"]}]}).then(e=>{if(!1===e.canceled){const t=e.filePaths[0],n=f.readFileSync(t).toString();B.getModel().setValue(n)}})}function D(){let e=new Date(+new Date+288e5);e="Log-"+e.toISOString(),e=e.replace(/[.|:]/g,"-"),!0===l.advance.sign.switch&&""!==l.advance.sign.name&&(e+="-"+l.advance.sign.name),p.showSaveDialog({properties:["createDirectory"],defaultPath:e,filters:[{name:"comNG Log",extensions:["cnl"]}]}).then(e=>{if(!1===e.canceled){const t=e.filePath,n=B.getModel().getValue();f.writeFileSync(t,n)}})}function H(){const e=new Date;return e.toLocaleTimeString().split(" ")[0]+":"+e.getMilliseconds().toString().padStart(3,0)+" "}function O(e){const t=B.getModel().getLineCount(),n=B.getModel().getLineMaxColumn(t),o=new monaco.Range(t,n,t,n);B.getModel().applyEdits([{forceMoveMarkers:!0,range:o,text:e.toString()}]),B.revealLine(B.getModel().getLineCount())}function W(e){return Array.prototype.map.call(new Uint8Array(e),e=>("00"+e.toString(16)).slice(-2)).join("")}function V(e){let t=W(e);for(;0!==t.length;){let e=8-v;t.length<e&&(e=t.length);let n=t.slice(0,e);0===(v=(v+e)%8)&&(4===++k?(k=0,n+="\n"):n+=" "),O(n),t=t.slice(e,t.length)}}function G(e){if(!1===x){let t=e;0!==T.length&&(t=Buffer.concat([T,e],e.length+T.length),T=[]),!0===t.includes(l.advance.breakpoint.onText)&&(x=!0,C=0)}else if(++C>=l.advance.breakpoint.afterLines)return x=!1,C=0,!0;return!1}function P(e){if(!0===l.general.hexmode)V(e);else{let t=-1;for(;-1!==(t=e.indexOf("\n"));){let n=e.slice(0,t+1);if(!0===S)O(n),S=!1;else{let e="";!0===l.general.timestamp&&(e=H()),O(e+n)}e=e.slice(t+1,e.length),!0===l.advance.breakpoint.switch&&!0===G(n)&&(e=[],J())}if(0!==e.length)if(!1===S){let t="";!0===l.general.timestamp&&(t=H()),O(t+e),S=!0}else O(e);!0===l.advance.breakpoint.switch&&(T=e)}}w.config({baseUrl:N(h.join(__dirname,"../node_modules/monaco-editor/min"))}),self.module=void 0,w(["vs/editor/editor.main"],(function(){monaco.languages.register({id:"comNGLang"}),monaco.languages.setMonarchTokensProvider("comNGLang",{defaultToken:"",tokenizer:{root:[[/^\[?[f|F][a|A][t|T][a|A][l|L]\]?\s.*/,"fatal"],[/\s+\[?[f|F][a|A][t|T][a|A][l|L]\]?\s+/,"fatal"],[/^\[?F\]?\s.*/,"fatal"],[/\s+\[?F\]?\s+/,"fatal"],[/^\[?[e|E][r|R][r|R][o|O][r|R]\]?\s.*/,"error"],[/\s+\[?[e|E][r|R][r|R][o|O][r|R]\]?\s+/,"error"],[/^\[?E\]?\s.*/,"error"],[/\s+\[?E\]?\s+/,"error"],[/^\[?[w|W][a|A][r|R][n|N]\]?\s.*/,"warn"],[/\s+\[?[w|W][a|A][r|R][n|N]\]?\s+/,"warn"],[/^\[?W\]?\s.*/,"warn"],[/\s+\[?W\]?\s+/,"warn"],[/^\[?[i|I][n|N][f|F][o|O]\]?\s.*/,"info"],[/\s+\[?[i|I][n|N][f|F][o|O]\]?\s+/,"info"],[/^\[?I\]?\s.*/,"info"],[/\s+\[?I\]?\s+/,"info"],[/^\[?[t|T][r|R][a|A][c|C][e|E]\]?\s.*/,"trace"],[/\s+\[?[t|T][r|R][a|A][c|C][e|E]\]?\s+/,"trace"],[/^\[?T\]?\s.*/,"trace"],[/\s+\[?T\]?\s+/,"trace"],[/^\[?[d|D][e|E][b|B][u|U][g|G]\]?\s.*/,"debug"],[/\s+\[?[d|D][e|E][b|B][u|U][g|G]\]?\s+/,"debug"],[/^\[?D\]?\s.*/,"debug"],[/\s+\[?D\]?\s+/,"debug"],[/\[\d;\d{2}m/,"useless"],[/\[\dm/,"useless"],[/[{}()[\]]/,"bracket"],[/^\d{1,2}:\d{2}:\d{2}:\d{1,3}/,"timestamp"],[/\d{1,4}(-|\/|\.|:)\d{1,2}\1\d{1,4}/,"time"],[/(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)(-|\/|\.|:)(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)\2(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)\2(25[0-5]|2[0-4]\d|[0-1]\d{2}|[1-9]?\d)/,"ip"],[/[0-9a-fA-F]{2}(-|\/|\.|:)[0-9a-fA-F]{2}\1[0-9a-fA-F]{2}\1[0-9a-fA-F]{2}\1[0-9a-fA-F]{2}\1[0-9a-fA-F]{2}/,"mac"],[/\d*\.\d+([eE][-+]?\d+)?/,"number"],[/0[xX][0-9a-fA-F]+/,"number"],[/[0-9a-fA-F]{4,}/,"number"],[/\d+/,"number"]]}}),monaco.editor.defineTheme("comNGTheme",{base:"vs",inherit:!1,colors:{"editor.background":"#fafafa","scrollbarSlider.background":"#fafafa"},rules:[{token:"number",foreground:"2e7d32"},{token:"bracket",foreground:"ff9800"},{token:"timestamp",foreground:"009688"},{token:"time",foreground:"2196f3"},{token:"ip",foreground:"03a9f4"},{token:"mac",foreground:"00bcd4"},{token:"fatal",foreground:"e91e63"},{token:"error",foreground:"f44336"},{token:"warn",foreground:"ff9800"},{token:"info",foreground:"9e9e9e"},{token:"trace",foreground:"9e9d24"},{token:"debug",foreground:"2e7d32"},{token:"useless",foreground:"cecece"}]}),B=monaco.editor.create(document.getElementById("editor-area"),{theme:"comNGTheme",language:"comNGLang",automaticLayout:!0,readOnly:!0,folding:!1,fontFamily:l.general.fontFamily,fontSize:l.general.fontSize,overviewRulerBorder:!1,scrollBeyondLastLine:!1,smoothScrolling:!0,mouseWheelZoom:!0,wordWrap:"on",wordWrapBreakAfterCharacters:"",wordWrapBreakBeforeCharacters:"",lineNumbersMinChars:3,minimap:{enabled:!1},scrollbar:{vertical:"auto",useShadows:!1,verticalScrollbarSize:10}});monaco.languages.setLanguageConfiguration("comNGLang",{brackets:[["{","}"],["[","]"],["(",")"],['"','"'],["'","'"]]}),B.addAction({id:"highlight-toggle",label:"Highlight Toggle",keybindings:[monaco.KeyMod.CtrlCmd|monaco.KeyCode.KEY_E],precondition:null,keybindingContext:null,contextMenuGroupId:"9_cutcopypaste",contextMenuOrder:1.5,run:z}),B.addCommand(monaco.KeyMod.CtrlCmd+monaco.KeyCode.KEY_W,()=>{}),B.addCommand(monaco.KeyMod.CtrlCmd+monaco.KeyCode.KEY_X,()=>{})})),document.getElementById("clear-btn").onclick=()=>{let e="";!0===l.advance.sign.switch&&(e="Captured at "+(new Date).toLocaleString()+" with comNG",""!==l.advance.sign.name&&(e+=" by "+l.advance.sign.name+"."),e+="\n"),v=0,B.getModel().setValue(e)},document.getElementById("editor-font-family").onblur=e=>{let t=e.target.value.trim();""===t&&(t="Consolas, 'SF Mono', Menlo, 'Lucida Console', 'Courier New', monospace"),B.updateOptions({fontFamily:t}),g("general.fontFamily",t)},document.getElementById("editor-font-size").onblur=e=>{let t=e.target.value.trim();""===t&&(t=12),B.updateOptions({fontSize:t}),g("general.fontSize",t)},document.getElementById("breakpoint-switch").onclick=e=>{if(!0===e.target.checked&&0===l.advance.breakpoint.onText.length)return Z("Error: Breakpoint on-text cant be empty"),void(e.target.checked=!1);g("advance.breakpoint.switch",e.target.checked),x=!1,C=0},document.getElementById("breakpoint-on-text").onblur=e=>{g("advance.breakpoint.onText",e.target.value)},document.getElementById("breakpoint-after-lines").onblur=e=>{let t=parseInt(e.target.value);!0===isNaN(t)&&(t=5),g("advance.breakpoint.afterLines",t)},document.getElementById("editor-area").ondragover=()=>!1,document.getElementById("editor-area").ondragleave=()=>!1,document.getElementById("editor-area").ondragend=()=>!1,document.getElementById("editor-area").ondrop=e=>(console.log("ondrop"),e.preventDefault(),e.dataTransfer.files[0].text().then(e=>{B.getModel().setValue(e)}),!1);const _=require("serialport");var q,K,U={cts:!1,dsr:!1,dcd:!1,rts:!0,dtr:!0};function Y(){let e=document.getElementById("path-select");e.options.length=0,_.list().then(t=>{t.forEach((t,n)=>{console.log(t,n),e.options.add(new Option(t.path,n)),n===l.pathIndex&&(e.selectedIndex=n)}),s.FormSelect.init(e)}).catch(e=>{console.error(e)})}function j(){if(void 0===q||!1===q.isOpen)return clearInterval(K);q.get((e,t)=>{if(e)return console.error(e);t.cts!==U.cts&&(U.cts=t.cts,!1===t.cts?document.getElementById("cts-btn").style.cssText="background-color: #dfdfdf !important":document.getElementById("cts-btn").style.cssText="background-color: #26a69a !important"),t.dsr!==U.dsr&&(U.dsr=t.dsr,!1===t.dsr?document.getElementById("dsr-btn").style.cssText="background-color: #dfdfdf !important":document.getElementById("dsr-btn").style.cssText="background-color: #26a69a !important"),t.dcd!==U.dcd&&(U.dcd=t.dcd,!1===t.dcd?document.getElementById("dcd-btn").style.cssText="background-color: #dfdfdf !important":document.getElementById("dcd-btn").style.cssText="background-color: #26a69a !important")})}function X(){U.cts=!1,U.dsr=!1,U.dcd=!1,U.rts=!0,U.dtr=!0,document.getElementById("cts-btn").style.cssText="background-color: #dfdfdf !important",document.getElementById("dsr-btn").style.cssText="background-color: #dfdfdf !important",document.getElementById("dcd-btn").style.cssText="background-color: #dfdfdf !important",document.getElementById("rts-btn").style.backgroundColor="",document.getElementById("dtr-btn").style.backgroundColor=""}function $(){let e={},t=parseInt(document.getElementById("baud-select").options[l.baudIndex].text);!0===isNaN(t)&&(t=115200),e.baudRate=t;let n=parseInt(document.getElementById("databits-select").options[l.general.databitsIndex].text);!0===isNaN(n)&&(n=8),e.dataBits=n;let o=document.getElementById("parity-select").options[l.general.parityIndex].text.toLowerCase();e.parity=o;let d=parseInt(document.getElementById("stopbits-select").options[l.general.stopbitsIndex].text);return!0===isNaN(d)&&(d=1),e.stopBits=d,e[document.getElementById("flowcontrol-select").options[l.general.flowcontrolIndex].text.toLowerCase()]=!0,e.autoOpen=!0,e}function Z(e){s.toast({html:e,displayLength:1e3})}function J(){void 0!==q&&q.close()}function Q(e){return void 0===q||!1===q.isOpen?(Z("Error: No port opened, cannot write"),void 0!==u&&clearInterval(u),!1):(q.write(e),!0)}document.getElementById("port-switch").onclick=e=>{if(!0===e.target.checked){let e=document.getElementById("path-select"),t=e.options[e.selectedIndex].label;(q=new _(t,$())).on("open",()=>{console.log("port open event"),void 0!==K&&clearInterval(K),!0===l.general.modemSignal&&(K=setInterval(j,100)),q.set({rts:!0,dtr:!0},e=>{null!==e&&console.error(e)})}),q.on("error",e=>{Z(e.message),document.getElementById("port-switch").checked=!1,void 0!==u&&clearInterval(u),void 0!==K&&clearInterval(K)}),q.on("close",e=>{console.log("port close event"),null!==e&&console.error(e),document.getElementById("port-switch").checked=!1,void 0!==u&&clearInterval(u),void 0!==K&&clearInterval(K),X()}),q.on("drain",()=>{Z("Error: Write failed, please try again")}),q.on("data",P)}else void 0===q||!1===q.isOpen?document.getElementById("port-switch").checked=!1:q.close()},document.getElementById("rts-btn").onclick=e=>{console.log("rts click"),void 0!==q&&!1!==q.isOpen&&(!0===U.rts?(U.rts=!1,e.target.style.backgroundColor="#dfdfdf",q.set({rts:!1},e=>{null!==e&&console.error(e)})):(U.rts=!0,e.target.style.backgroundColor="",q.set({rts:U.rts,dtr:U.dtr},e=>{null!==e&&console.error(e)})))},document.getElementById("dtr-btn").onclick=e=>{console.log("dtr click"),void 0!==q&&!1!==q.isOpen&&(!0===U.dtr?(U.dtr=!1,e.target.style.backgroundColor="#dfdfdf",q.set({dtr:!1},e=>{null!==e&&console.error(e)})):(U.dtr=!0,e.target.style.backgroundColor="",q.set({rts:U.rts,dtr:!0},e=>{null!==e&&console.error(e)})))};